---
title: "Warm-up mini-Report: Mosquito Blood Hosts in \n Salt Lake City, Utah"
author: "Kayla Howa"
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ABSTRACT

House finches are a large host body for the transmission of West Nile Virus in Salt Lake City, UT. Their large abundance and long duration of detectible viremea aid mosquitoes in the positive transmission of the disease.

# BACKGROUND

### An Intro to West Nile Virus

West Nile Virus (WNV) originated in New York in 1999 (Wikimedia Foundation, 2025). It is a virus that is transferred from birds, which are the primary host for the virus, to the mosquitoes that feed on infected birds. Then, WNV may be transferred to humans or a variety of other species that infected mosquitoes feed on.

By monitoring the animals that host WNV and applying it to viremia duration data (Kumar et al., 2003), we can monitor and predict transmission risks for various areas. We capture mosquitoes in either gravid traps or CO2 traps. Then, we extract the blood meal DNA from them and analyze/sequence the DNA.

# STUDY QUESTION & HYPOTHESIS

## Questions

What bird species is acting as the primary WNV amplifying host in the Salt Lake City, UT area?

## Hypothesis

We hypothesize that house finches serve as the primary amplifying hosts for WNV due to their high viremia duration and large presence in the Salt Lake City area.

## Prediction

We predict that locations with a higher ratio of house finches in our blood host analysis are also the same locations with elevated positive tests for WNV.

## 

# METHODS

### Blood Meal DNA Extraction

By taking mosquitoes that were collected from the two traps types, we can then extract the DNA by placing a single mosquito in a microcentrifuge tube along with 100 micro liters of DNA extraction/lysis buffer. Then, we can mash the mosquito with a pestle.

### PCR

Once the DNA has been extracted from the mosquito, we will run a PCR in order to amplify the extracted DNA. In each well of a 96 well plate, we pipette the extracted DNA and a reagent. We also pipette a negative and positive control into two other empty wells then set up the thermocycler.

The thermocycler is the machine that runs the PCR by increasing and decreasing the temperature of our samples for a certain amount of cycles in order to amplify the DNA. Once the desired run is set, we start it and wait for it to complete.

### Sequencing

We are able to determine if our samples have any DNA successfully amplified after the PCR is complete by running a gel electrophoresis. We place our samples into the gel and the electricity current pulls the DNA fragments up the gel. This separates our DNA fragments that we amplified by size with smaller fragments moving further up the gel than larger fragments. Bands appear on the gel and we can compare where the sample bands are to our DNA ladder to determine the size of our DNA fragments.

Once we know that we do have DNA, we can sequence it using MinION. By using electric currents, similar to the gel electrophoresis, we can determine the sequence of nucleotide sequences based on how the nucleic acids change the current of the electricity.

### Analysis

Last, with our newly acquired nucleotide sequences, we can paste our collected sequence into BLASTn to identify what species the DNA belongs to!

## Analysis that allows my other analyses to work
```{r first-analysis, warning=FALSE}
## import counts_matrix: data.frame with column 'loc_positives' (0/1) and host columns 'host_*'
counts_matrix <- read.csv("/Users/kaylapedersen/Desktop/USU/2025/Fall 2025/CompBio/R/Warm-up-mosquitoes-TEMPLATE_files/bloodmeal_plusWNV_for_BIOL3070.csv")

## 1) Identify host columns
host_cols <- grep("^host_", names(counts_matrix), value = TRUE)

if (length(host_cols) == 0) {
  stop("No columns matching '^host_' were found in counts_matrix.")
}

## 2) Ensure loc_positives is present and has both levels 0 and 1 where possible
counts_matrix$loc_positives <- factor(counts_matrix$loc_positives, levels = c(0, 1))

## 3) Aggregate host counts by loc_positives
agg <- stats::aggregate(
  counts_matrix[, host_cols, drop = FALSE],
  by = list(loc_positives = counts_matrix$loc_positives),
  FUN = function(x) sum(as.numeric(x), na.rm = TRUE)
)

## make sure both rows exist; if one is missing, add a zero row
need_levels <- setdiff(levels(counts_matrix$loc_positives), as.character(agg$loc_positives))
if (length(need_levels)) {
  zero_row <- as.list(rep(0, length(host_cols)))
  names(zero_row) <- host_cols
  for (lv in need_levels) {
    agg <- rbind(agg, c(lv, zero_row))
  }
  ## restore proper type
  agg$loc_positives <- factor(agg$loc_positives, levels = c("0","1"))
  ## coerce numeric host cols (they may have become character after rbind)
  for (hc in host_cols) agg[[hc]] <- as.numeric(agg[[hc]])
  agg <- agg[order(agg$loc_positives), , drop = FALSE]
}

## 4) Decide species order (overall abundance, descending)
overall <- colSums(agg[, host_cols, drop = FALSE], na.rm = TRUE)
host_order <- names(sort(overall, decreasing = TRUE))
species_labels <- rev(sub("^host_", "", host_order))  # nicer labels

## 5) Build count vectors for each panel in the SAME order
counts0 <- rev(as.numeric(agg[agg$loc_positives == 0, host_order, drop = TRUE]))
counts1 <- rev(as.numeric(agg[agg$loc_positives == 1, host_order, drop = TRUE]))

## 6) Colors: reuse your existing 'cols' if it exists and is long enough; otherwise generate
if (exists("cols") && length(cols) >= length(host_order)) {
  species_colors <- setNames(cols[seq_along(host_order)], species_labels)
} else {
  species_colors <- setNames(rainbow(length(host_order) + 10)[seq_along(host_order)], species_labels)
}

## 7) Shared x-limit for comparability
xmax <- max(c(counts0, counts1), na.rm = TRUE)
xmax <- if (is.finite(xmax)) xmax else 1
xlim_use <- c(0, xmax * 1.08)

## 8) Plot: two horizontal barplots with identical order and colors
op <- par(mfrow = c(1, 2),
          mar = c(4, 12, 3, 2),  # big left margin for species names
          xaxs = "i")           # a bit tighter axis padding

## Panel A: No WNV detected (loc_positives = 0)
barplot(height = counts0,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (-)",
        xlim = xlim_use)

## Panel B: WNV detected (loc_positives = 1)
barplot(height = counts1,
        names.arg = species_labels, 
        cex.names = .5,
        cex.axis = .5,
        col = rev(unname(species_colors[species_labels])),
        horiz = TRUE,
        las = 1,
        xlab = "Bloodmeal counts",
        main = "Locations WNV (+)",
        xlim = xlim_use)

par(op)

## Keep the colors mapping for reuse elsewhere
host_species_colors <- species_colors
```

## First Analysis (Viremia Duration Plot)

```{r viremia, eval=TRUE, fig.align='left', fig.height=7, fig.width=4.75, warning=FALSE, include=TRUE}
# Manually transcribe duration (mean, lo, hi) from the last table column
duration <- data.frame(
  Bird = c("Canada Goose","Mallard", 
           "American Kestrel","Northern Bobwhite",
           "Japanese Quail","Ring-necked Pheasant",
           "American Coot","Killdeer",
           "Ring-billed Gull","Mourning Dove",
           "Rock Dove","Monk Parakeet",
           "Budgerigar","Great Horned Owl",
           "Northern Flicker","Blue Jay",
           "Black-billed Magpie","American Crow",
           "Fish Crow","American Robin",
           "European Starling","Red-winged Blackbird",
           "Common Grackle","House Finch","House Sparrow"),
  mean = c(4.0,4.0,4.5,4.0,1.3,3.7,4.0,4.5,5.5,3.7,3.2,2.7,1.7,6.0,4.0,
           4.0,5.0,3.8,5.0,4.5,3.2,3.0,3.3,6.0,4.5),
  lo   = c(3,4,4,3,0,3,4,4,4,3,3,1,0,6,3,
           3,5,3,4,4,3,3,3,5,2),
  hi   = c(5,4,5,5,4,4,4,5,7,4,4,4,4,6,5,
           5,5,5,7,5,4,3,4,7,6)
)

# Choose some colors
cols <- c(rainbow(30)[c(10:29,1:5)])  # rainbow colors

# horizontal barplot
par(mar=c(5,12,2,2))  # wider left margin for names
bp <- barplot(duration$mean, horiz=TRUE, names.arg=duration$Bird,
              las=1, col=cols, xlab="Days of detectable viremia", xlim=c(0,7))

# add error bars
arrows(duration$lo, bp, duration$hi, bp,
       angle=90, code=3, length=0.05, col="black", xpd=TRUE)
```

## Second Analysis (Map)

```{r, Second Analysis warning=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)

hm <- counts_matrix %>%
  filter(!is.na(long), !is.na(lat)) %>%
  transmute(
    long, lat,
    `WNV-positive pools (rate)` = loc_rate,
    `House finch blood meals`   = host_House_finch
  ) %>%
  pivot_longer(-c(long, lat), names_to = "metric", values_to = "value") %>%
  mutate(value = ifelse(is.na(value), 0, value))

# plot extent (a small pad around data)
xpad <- diff(range(hm$long))*0.05
ypad <- diff(range(hm$lat))*0.05
xlim <- range(hm$long) + c(-xpad, xpad)
ylim <- range(hm$lat) + c(-ypad, ypad)

ggplot(hm, aes(long, lat)) +
  borders("state", regions = "utah", colour = "grey75", fill = NA) +
  # KDE hotspot, weighted by value
  stat_density_2d_filled(
    aes(weight = value, fill = after_stat(level)),
    contour_var = "ndensity", geom = "polygon",
    bins = 12, alpha = 0.9, adjust = 0.8
  ) +
  # optional faint contours
  stat_density_2d(
    aes(weight = value, color = after_stat(level)),
    contour_var = "ndensity", bins = 12, linewidth = 0.15, show.legend = FALSE
  ) +
  # show sites lightly on top
  geom_point(aes(size = pmax(value, 0.0001)), alpha = 0.5, shape = 21, stroke = 0.2,
             fill = NA, color = "grey30", show.legend = FALSE) +
  coord_quickmap(xlim = xlim, ylim = ylim) +
  facet_wrap(~ metric, nrow = 1) +
  scale_fill_viridis_d(option = "C", direction = -1, name = "Hotspot") +
  guides(color = "none") +
  theme_minimal() +
  labs(x = NULL, y = NULL)
```

# DISCUSSION

### Interpretation - First Analysis (Viremia Duration Plot)

The first plot shows a horizontal bar graph featuring many different avian species on the y-axis and a scale of days of detectable viremia ranging from 0-7 on the x-axis. This graph appears to contain two or three larger peaks in days of detectable viremia. Specifically, these peaks come from the House Finch, Great Horned Owl, and Red-Billed Gull. Larger peaks suggest a longer amount of time that there is detectable viremia in these species blood which allows for longer transmission capabilites from mosquitoes.

### Interpretation - Second Analysis (Map)

This second plot shows two heat maps. The heat map on the left shows House finch blood meals while the heat map on the right shows WNV-positive pools (rate). The fact that these two maps can almost perfectly fit ontop of each other suggests that the House finch could be directly correlated to increases in WNV-positive pools, as the areas that contain more House finches also contain more WNV-positive pools.

# CONCLUSION

As a reminder, we hypothesized that house finches serve as the primary amplifying hosts for WNV due to their high viremia duration and large presence in the Salt Lake City area. Additionally, we predicted that locations with a higher ratio of house finches in our blood host analysis are also the same locations with elevated positive tests for WNV. Based on evidence of a long detectible viremea in House finches, and the correlation between House finch blood meals and WNV-positive rates, there is evidence to suggest our prediction and hypothesis are correct.

# REFERENCES

1.  Komar N, Langevin S, Hinten S, Nemeth N, Edwards E, Hettler D, Davis B, Bowen R, Bunning M. Experimental infection of North American birds with the New York 1999 strain of West Nile virus. Emerg Infect Dis. 2003 Mar;9(3):311-22. <https://doi.org/10.3201/eid0903.020628>

2.  Wikimedia Foundation. (2025, September 3). West Nile virus. Wikipedia. <https://en.wikipedia.org/wiki/West_Nile_virus>
